# 📈 個人資產管理系統：對帳單聯動優化計畫 (Roadmap)

## 📌 核心邏輯轉變
* **舊流程**：手動計算總成本 -> 手動輸入 `StockHolding.ps1`。
* **新流程**：輸入交易明細（買入/賣出） -> 系統自動計算累計股數、平均成本、手續費 -> 聯動生成報表。

---

## 🛠 步驟一：定義對帳單數據結構 (Transaction Schema)
**目標：建立一個能完整記錄交易細節的 CSV 格式。**

* **執行內容**：
    1.  定義 `transactions.csv` 欄位：`日期`, `標的代號`, `標的名稱`, `動作(買入/賣出)`, `成交單價`, `成交股數`, `手續費`, `交易稅`, `總金額(淨值)`。
    2.  在 `config.json` 加入手續費率設定（例如 `0.001425`），作為輸入時的自動計算參考。
* **檢查點**：手動建立一個測試 CSV，確認能正確表達「分批買入」的兩筆資料。

---

## 🛠 步驟二：開發交易錄入模組 (`Invoke-TransactionFlow`)
**目標：建立 PowerShell 介面，讓使用者可以輸入每一筆買賣。**

* **執行內容**：
    1.  在 `modules/` 資料夾建立 `Transaction.ps1`。
    2.  實作輸入邏輯：當使用者輸入單價與股數，系統自動根據 `config.json` 計算預估手續費，並允許使用者手動修正為「實際金額」。
    3.  將資料存入 `output/history_data/Transactions/`。
* **檢查點**：在 `AssetManager.ps1` 選單中新增「錄入交易明細」選項，並確認能成功存檔。

---

## 🛠 步驟三：開發核心計算引擎 (The Calculator)
**目標：將零散的交易紀錄轉換為「當前庫存狀態」。**

* **執行內容**：
    1.  撰寫邏輯處理 `transactions.csv`：
        * **總持有股數** = 累計買入股數 - 累計賣出股數。
        * **加權平均成本** = (Σ買入成交總額) / 總買入股數。
    2.  處理「已實現損益」：當有「賣出」動作時，自動計算與「平均成本」的價差。
* **檢查點**：執行腳本後，能在終端機正確顯示某支股票目前的「精準總成本（含手續費）」。

---

## 🛠 步驟四：重構舊有模組與聯動 (Refactoring)
**目標：讓原本需要手動輸入的模組改為「自動計算」。**

* **執行內容**：
    1.  **修改 `StockHolding.ps1`**：取消「輸入總成本」的步驟，改為從步驟三的計算結果自動帶入。
    2.  **修改 `RealizedPnL.ps1`**：賣出時，自動帶入該股票的平均成本，使用者只需確認賣出價格。
* **檢查點**：確認產出的 `stock_holdings.csv` 中的「總成本」與你證券對帳單上的數字完全吻合。

---

## 🛠 步驟五：視覺化呈現與自動股價 (Enhancement)
**目標：在前端呈現精準數據，並引入自動市值更新。**

* **執行內容**：
    1.  在 `index.html` 中新增「交易流水帳」的分頁展示。
    2.  整合 Web API（如 Yahoo Finance）：此時自動抓取的股價僅用於更新「市值」與「未實現損益」，**不觸碰**由對帳單算出的「總成本」。
* **檢查點**：儀表板能同時顯示「實際投入成本（含費）」與「當前即時市值」。

---

## ⚠️ 注意事項
* **不要跳步**：在步驟三的計算邏輯（平均成本算法）未驗證準確前，請勿進行步驟四的模組替換。
* **手續費陷阱**：台灣股市手續費不滿 20 元通常按 20 元計，腳本邏輯需考慮此最小值。