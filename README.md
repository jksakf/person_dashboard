# 個人資產視覺化系統 (PowerShell 版) - 使用說明

## 📋 系統簡介

這是一個整合 PowerShell 自動化腳本與 HTML 視覺化儀表板的個人資產管理系統。透過互動式的 PowerShell 介面輸入資產與交易資料，並產生標準格式的 CSV 檔案，最後使用網頁儀表板進行視覺化分析。

### ✨ 主要特色
- **PowerShell 核心**：原生支援 Windows 環境，無需安裝 Python 或其他依賴。
- **資料自動保存**：前端採用 LocalStorage 技術，重新整理頁面資料不遺失。
- **模組化設計**：前端採用 Namespace 模組化架構，維護性高且相容 `file://` 執行。
- **交易流水帳**：完整記錄每一筆買賣，自動計算預估手續費與稅金。
- **自動股價更新**：整合網頁爬蟲 (Yahoo Finance)，一鍵更新持股市值。
- **視覺化儀表板**：
    - **歷史日期篩選**：可回顧過去任一時間點的資產狀態。
    - **動態圖表**：圓餅圖（資產分佈）、折線圖（資產趨勢）與損益分析。
    - **迷你走勢圖 (Sparklines)**：直觀呈現近 30 天的資產變化。
    - **批次上傳**：支援一鍵載入所有資料檔，操作更便捷。

---

## 🚀 快速開始

### 1. 環境需求
- **作業系統**：Windows 10 / 11
- **執行環境**：PowerShell 5.1 或更高版本
- **瀏覽器**：Chrome, Edge, Firefox 等現代瀏覽器

### 2. 檔案結構
```
資產視覺化/
├── README.md                  # 本說明文件
├── AssetManager.ps1           # 🚀 主程式入口 (啟動腳本)
├── common.ps1                 # 通用函式庫
├── account_list.txt           # 銀行帳戶設定檔
├── stock_list.txt             # 股票代號設定檔
├── index.html                 # 📊 視覺化儀表板
├── js/                        # 前端核心程式
│   ├── main.js                # 程式進入點
│   ├── core/                  # 核心模組 (init, utils, data)
│   └── modules/               # 業務邏輯 (bank, stock, pnl, history)
├── modules/                   # PowerShell 功能模組
│   ├── BankAsset.ps1          # 銀行資產模組
│   ├── RealizedPnL.ps1        # 已實現損益模組
│   ├── Transaction.ps1        # 交易錄入模組
│   ├── CostCalculator.ps1     # 成本計算核心
│   ├── PriceFetcher.ps1       # 股價爬蟲模組
│   ├── PriceUpdater.ps1       # 市值更新模組
│   └── DataMerger.ps1         # 資料合併工具
└── output/                    # 資料輸出目錄
    ├── bank_asset/            # 保存銀行資產 CSV
    ├── stock_holding/         # 保存股票庫存 CSV
    ├── realized_pnl/          # 保存已實現損益 CSV
    └── transactions/          # 保存交易流水帳 CSV
```

---

## 📝 使用步驟

### Step 1: 基礎設定

在使用前，請先編輯以下設定檔以符合您的個人情況：

#### 1. `account_list.txt` (銀行帳戶清單)
每行輸入一個帳戶名稱：
```text
台銀
富邦
國泰世華
```

#### 2. `stock_list.txt` (股票追蹤清單)
格式為 `市場,股票代號,股票名稱`：
```text
台股,2330,台積電
台股,2317,鴻海
ETF,00878,國泰永續高股息
美股,AAPL,蘋果
```

---

### Step 2: 輸入資產與交易資料

1. 在資料夾中按右鍵，選擇 **「在終端機中開啟」** (Open in Terminal)。
2. 執行主程式：
   ```powershell
   .\AssetManager.ps1
   ```
3. 系統將顯示主選單，請依需求選擇功能：
   ```text
   ==================================
   💰 個人資產資料管理系統 (PowerShell)
   ==================================
   1. 銀行資產輸入
   2. 更新股價與市值 (Update Price)    <-- 自動抓取 Yahoo Finance 股價
   3. 已實現損益輸入
   4. 錄入交易明細 (New Transaction)  <-- 推薦使用，可自動計算成本
   5. 合併年度資料 (Merge CSV)
   6. 🗑️ 刪除交易紀錄
   0. 🚪 離開
   ==================================
   ```
4. **重要**：輸入完成後，建議執行選項 `6` **「合併年度資料」**，系統將產生 `output/ALL_HISTORY_merged_*.csv` 檔案，供儀表板讀取。

---

### Step 3: 啟動視覺化儀表板

1. 雙擊開啟 `index.html`。
2. **自動還原**：若您之前曾匯入過資料，系統會自動從暫存區 (LocalStorage) 還原，無需重複上傳。
3. **匯入新資料**：若需更新數據，有兩種方式：
   - **方式 A (推薦)**：將 `output` 資料夾中的 `ALL_HISTORY_merged_*.csv` 檔案直接 **拖曳 (Drag & Drop)** 到網頁中央的「📂 拖曳所有 CSV 檔案至此」區域。
   - **方式 B**：點擊 **「🚀 選擇檔案」** 按鈕，並在視窗中選取檔案。
   - 系統會自動辨識檔案類型並載入對應的圖表。

---

## 🎯 儀表板功能詳解

### 1. 個人資產 (銀行)
- **總資產趨勢**：折線圖顯示資產隨時間的增長變化。
- **帳戶明細表**：列出各帳戶金額與資產佔比。

### 2. 股票庫存
- **損益分析**：自動計算未實現損益與報酬率，並以紅/綠色標示。
- **持股分佈**：依市值繪製圓餅圖。
- **自動計價**：若有使用 PowerShell 的「更新股價」功能，此處顯示的市值將是最新市場價格。

### 3. 已實現損益
- **交易績效**：顯示總獲利/虧損金額。
- **交易明細**：詳細列出每一筆賣出的損益紀錄。

### 4. 交易歷史
- **流水帳檢視**：查看所有買入與賣出的詳細紀錄，便於對帳與回溯。

---

## 💡 常見問題 (FAQ)

### Q1: 執行腳本時出現「禁止執行指令碼」的錯誤？
**A**: 這是 PowerShell 的安全設定。請以管理員身分執行 PowerShell，並輸入以下指令開啟權限：
```powershell
Set-ExecutionPolicy RemoteSigned
```

### Q2: 為什麼圖表上有資料，但日期選單是空的？
**A**: 請確認您上傳的是 **合併後** 的 CSV 檔案（檔名通常包含 `merged`），而不是單日的原始檔案。單日檔案只有一天的資料，無法進行歷史篩選。

---

## 🛠 更新日誌

- **2026-01-30**: 前端架構重構 (Modularization)；新增資料自動保存 (LocalStorage)、迷你走勢圖 (Sparklines) 與拖放上傳功能。
- **2026-01-29**: 更新文件；新增交易錄入、股價爬蟲、成本計算與批次上傳功能說明。
- **2026-01-26**: 重構為 PowerShell 版本；新增儀表板日期篩選與明細表格功能。
