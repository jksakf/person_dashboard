# 個人資產管理系統 - AI Agent 協作開發指南

> 本文件專為 AI Agent 協作設計，每個步驟獨立完成後再進行下一步

---

## 📋 專案概述

**目標**: 建立個人資產追蹤系統，使用 Python 產生 CSV 資料，用 HTML 網頁呈現圖表

**技術棧**:
- 後端: Python 3.7+ (資料處理)
- 前端: HTML + Chart.js + PapaParse
- 資料格式: CSV (UTF-8)

**核心功能**:
1. 產生三種 CSV: 銀行資產、股票庫存、已實現損益
2. 網頁讀取 CSV 並用圖表呈現
3. 支援月份篩選、市場篩選

---

## 🎯 開發步驟總覽

```
Step 1: Python 資料產生器 - 銀行資產模組 ✅ [預估 30 分鐘]
Step 2: Python 資料產生器 - 股票庫存模組 ⏳ [預估 30 分鐘]
Step 3: Python 資料產生器 - 已實現損益模組 ⏳ [預估 30 分鐘]
Step 4: Python 資料產生器 - 整合介面 ⏳ [預估 30 分鐘]
Step 5: HTML 網頁 - 基礎架構與樣式 ⏳ [預估 45 分鐘]
Step 6: HTML 網頁 - CSV 上傳與解析 ⏳ [預估 30 分鐘]
Step 7: HTML 網頁 - 個人資產頁面 ⏳ [預估 45 分鐘]
Step 8: HTML 網頁 - 股票庫存頁面 ⏳ [預估 45 分鐘]
Step 9: HTML 網頁 - 已實現損益頁面 ⏳ [預估 45 分鐘]
Step 10: 測試與優化 ⏳ [預估 30 分鐘]
```

**總預估時間**: 約 6 小時

---

## 📍 當前進度

**目前狀態**: Step 0 - 準備開始
**下一步**: Step 1 - 銀行資產模組

---

資產計算正確

### 提示給 AI Agent
請建立一個 Python 檔案 `bank_asset_generator.py`，包含：
- 匯入必要模組 (csv, os)
- BankAssetGenerator 類別
- 範例資料（至少 3 筆）
- 測試執行區塊

---

## 🔧 Step 2: Python 資料產生器 - 股票庫存模組

### 任務目標
建立 Python 3 程式，產生股票庫存 CSV 檔案

### 輸入資料格式
```python
[
    {
        "年月": "2025-01",
        "市場": "台股",
        "股票代號": "2330",
        "股票名稱": "台積電",
        "持有股數": 10,
        "總成本": 5000,
        "總市值": 5800
    }
]
```

### 輸出檔案格式 (stock_holdings.csv)
```csv
年月,市場,股票代號,股票名稱,持有股數,總成本,總市值,未實現損益,報酬率%
2025-01,台股,2330,台積電,10,5000,5800,800,16.00
```

### 程式需求
1. 建立 `StockHoldingGenerator` 類別
2. 實作 `generate_csv(data, output_path)` 方法
3. 自動計算以下欄位：
   - **未實現損益 = 總市值 - 總成本**
   - 報酬率% = (未實現損益 / 總成本) × 100
4. 報酬率保留兩位小數
5. 使用 UTF-8-sig 編碼
6. 使用 Python 3 語法

### 驗收標準
- [ ] 程式可在 Python 3 執行不報錯
- [ ] 未實現損益計算邏輯正確（總市值 - 總成本）
- [ ] 支援三種市場: 台股、複委託-美股、複委託-港股
- [ ] 報酬率格式正確（如 16.00）

### 提示給 AI Agent
請建立一個 Python 3 檔案 `stock_holding_generator.py`，包含：
- StockHoldingGenerator 類別
- 範例資料（包含台股、美股、港股各一筆）
- 數值計算邏輯（未實現損益 = 總市值 - 總成本）
- 測試執行區塊

---

## 🔧 Step 3: Python 資料產生器 - 已實現損益模組

### 任務目標
建立 Python 3 程式，產生已實現損益 CSV 檔案

### 輸入資料格式
```python
[
    {
        "日期": "2025-01-15",
        "市場": "台股",
        "股票代號": "2454",
        "股票名稱": "聯發科",
        "賣出股數": 5,
        "總成本": 4000,
        "賣出價": 4500
    }
]
```

### 輸出檔案格式 (realized_pnl.csv)
```csv
日期,市場,股票代號,股票名稱,賣出股數,總成本,賣出價,已實現損益,報酬率%
2025-01-15,台股,2454,聯發科,5,4000,4500,500,12.50
```

### 程式需求
1. 建立 `RealizedPnLGenerator` 類別
2. 實作 `generate_csv(data, output_path)` 方法
3. 自動計算以下欄位：
   - **已實現損益 = 賣出價 - 總成本**
   - 報酬率% = (已實現損益 / 總成本) × 100
4. **移除「交易類型」欄位**
5. 報酬率保留兩位小數
6. 使用 UTF-8-sig 編碼
7. 使用 Python 3 語法

### 驗收標準
- [ ] 程式可在 Python 3 執行不報錯
- [ ] 已實現損益計算邏輯正確（賣出價 - 總成本）
- [ ] 損益計算正確（可為負數）
- [ ] 支援多種市場
- [ ] 日期格式為 YYYY-MM-DD
- [ ] 輸出 CSV 無「交易類型」欄位

### 提示給 AI Agent
請建立一個 Python 3 檔案 `realized_pnl_generator.py`，包含：
- RealizedPnLGenerator 類別
- 範例資料（包含賺錢和賠錢的交易）
- 數值計算邏輯（已實現損益 = 賣出價 - 總成本）
- 不包含「交易類型」欄位
- 測試執行區塊

---

## 🔧 Step 4: Python 資料產生器 - 整合介面

### 任務目標
建立主程式，整合三個模組並提供互動式選單

### 程式需求
1. 建立 `asset_data_manager.py` 主程式
2. **僅需要 Python 3 標準函式庫**（不使用 pandas）
3. 匯入前三個步驟的類別
4. 提供互動式選單：
   ```
   1. 產生銀行資產 CSV
   2. 產生股票庫存 CSV
   3. 產生已實現損益 CSV
   4. 產生全部 CSV
   5. 查看範例資料格式
   0. 離開
   ```
5. 建立 `output/` 資料夾存放 CSV
6. 整合所有範例資料

### 範例資料更新
```python
# 銀行資產範例（使用圖片中的銀行名稱）
bank_data = [
    {
        "年月": "2025-01",
        "富邦": 100000,
        "將來": 50000,
        "國泰證券交割戶": 200000,
        "國泰(青年子帳戶)": 500000,
        "LINEPAY": 5000,
        "股票/ETF(國泰)": 300000,
        "保單金": 0
    }
]

# 股票庫存範例（使用總成本、總市值）
stock_data = [
    {
        "年月": "2025-01",
        "市場": "台股",
        "股票代號": "2330",
        "股票名稱": "台積電",
        "持有股數": 10,
        "總成本": 5000,
        "總市值": 5800
    }
]

# 已實現損益範例（使用總成本，無交易類型）
pnl_data = [
    {
        "日期": "2025-01-15",
        "市場": "台股",
        "股票代號": "2454",
        "股票名稱": "聯發科",
        "賣出股數": 5,
        "總成本": 4000,
        "賣出價": 4500
    }
]
```

### 檔案結構
```
asset_data_manager.py      # 主程式（僅需 Python 3）
output/                    # 產生的 CSV
    bank_assets.csv
    stock_holdings.csv
    realized_pnl.csv
```

### 驗收標準
- [ ] 僅使用 Python 3 標準函式庫（無需安裝額外套件）
- [ ] 選單操作流暢
- [ ] 可以選擇性產生檔案
- [ ] 選項 4 可一次產生全部
- [ ] 產生成功有明確提示訊息
- [ ] 產生的檔案在 output/ 資料夾
- [ ] 範例資料使用新格式

### 提示給 AI Agent
請建立主程式，整合前面三個模組。需要：
- **僅使用 Python 3 內建模組**（csv, os 等）
- 匯入三個 Generator 類別
- while 迴圈實作選單
- 錯誤處理（無效輸入）
- 建立輸出資料夾（如果不存在）
- 友善的使用者提示
- 使用更新後的範例資料格式

---

## 🔧 Step 5: HTML 網頁 - 基礎架構與樣式

### 任務目標
建立 HTML 網頁的基礎結構和 CSS 樣式

### 頁面需求
1. 建立 `index.html`
2. 包含三個分頁的架構：
   - 個人資產
   - 股票庫存
   - 已實現損益
3. 頂部包含：
   - 標題
   - 檔案上傳區（三個檔案上傳欄位）
4. 分頁切換功能
5. 響應式設計（支援手機）

### 引入外部資源
```html
<!-- CDN 資源 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
```

### 設計風格
- 主色調: 紫色漸層 (#667eea to #764ba2)
- 卡片式設計，帶陰影
- 分頁按鈕有 hover 效果
- 統計卡片用漸層背景

### 驗收標準
- [ ] HTML 結構完整
- [ ] CSS 樣式美觀
- [ ] 分頁切換功能正常
- [ ] 手機版排版正常
- [ ] 上傳欄位已建立（功能先不實作）

### 提示給 AI Agent
請建立 HTML 網頁，包含：
- 完整的 HTML 結構
- 嵌入式 CSS 樣式
- 分頁切換的 JavaScript 函式
- 三個 tab content div（內容先空白）
- RWD 設計（使用 @media query）

---

## 🔧 Step 6: HTML 網頁 - CSV 上傳與解析

### 任務目標
實作 CSV 檔案上傳和解析功能

### 功能需求
1. 監聽三個檔案上傳欄位：
   - `#bankFile` → 銀行資產
   - `#stockFile` → 股票庫存
   - `#pnlFile` → 已實現損益
2. 使用 PapaParse 解析 CSV
3. 將資料儲存到全域變數：
   ```javascript
   let bankData = [];
   let stockData = [];
   let pnlData = [];
   ```
4. 解析完成後顯示提示訊息

### 程式邏輯
```javascript
document.getElementById('bankFile').addEventListener('change', (e) => {
    const file = e.target.files[0];
    Papa.parse(file, {
        header: true,
        encoding: 'UTF-8',
        complete: (results) => {
            bankData = results.data;
            console.log('銀行資產資料已載入', bankData);
        }
    });
});
```

### 驗收標準
- [ ] 上傳 CSV 後資料儲存到變數
- [ ] Console 可以看到解析後的資料
- [ ] 支援中文檔名和內容
- [ ] 錯誤檔案有適當提示

### 提示給 AI Agent
在 Step 5 的 HTML 中加入 JavaScript：
- 建立三個全域變數
- 實作三個檔案上傳監聽器
- 使用 PapaParse 解析 CSV
- 在 console 顯示載入結果
- 加入基本錯誤處理

---

## 🔧 Step 7: HTML 網頁 - 個人資產頁面

### 任務目標
實作個人資產分頁的完整功能

### 功能需求
1. **月份選擇器**: 根據資料動態產生選項
2. **統計卡片**: 顯示總資產、現金、定存、股票市值
3. **圓餅圖**: 顯示資產配置（現金、活存、定存、基金、股票）
4. **折線圖**: 顯示總資產趨勢（所有月份）

### HTML 結構（已在 Step 5 建立）
```html
<div id="assets" class="tab-content">
    <!-- 篩選器 -->
    <select id="assetMonthFilter"></select>
    
    <!-- 統計卡片 -->
    <div id="assetStats"></div>
    
    <!-- 圓餅圖 -->
    <canvas id="assetPieChart"></canvas>
    
    <!-- 折線圖 -->
    <canvas id="assetTrendChart"></canvas>
</div>
```

### JavaScript 函式
```javascript
function renderAssets() { }          // 主渲染函式
function filterAssetsByMonth() { }   // 月份篩選
function renderAssetPieChart() { }   // 圓餅圖
function renderAssetTrend() { }      // 折線圖
function formatMoney(value) { }      // 金額格式化
```

### 驗收標準
- [ ] 上傳 CSV 後自動渲染
- [ ] 月份選擇器有正確選項
- [ ] 統計卡片數字正確
- [ ] 圓餅圖顯示正常
- [ ] 折線圖趨勢正確
- [ ] 金額格式化為 $1,150,000

### 提示給 AI Agent
在 Step 6 的基礎上，加入：
- 實作 `renderAssets()` 函式
- 使用 Chart.js 建立圓餅圖和折線圖
- 實作金額格式化函式
- 在 CSV 載入完成後自動呼叫渲染
- 圖表使用漸層色彩

---

## 🔧 Step 8: HTML 網頁 - 股票庫存頁面

### 任務目標
實作股票庫存分頁的完整功能

### 功能需求
1. **月份選擇器**: 選擇要查看的月份
2. **市場篩選器**: 下拉選單（全部/台股/複委託-美股/複委託-港股）
3. **統計卡片**: 總市值、未實現損益、平均報酬率
4. **圓餅圖**: 顯示持股市值分布（依股票名稱）
5. **表格**: 列出所有持股明細（可依市場篩選）

### HTML 結構（已在 Step 5 建立）
```html
<div id="stocks" class="tab-content">
    <!-- 篩選器 -->
    <select id="stockMonthFilter"></select>
    <select id="marketFilter"></select>
    
    <!-- 統計卡片 -->
    <div id="stockStats"></div>
    
    <!-- 圓餅圖 -->
    <canvas id="stockPieChart"></canvas>
    
    <!-- 表格 -->
    <table id="stockTable"></table>
</div>
```

### JavaScript 函式
```javascript
function renderStocks() { }           // 主渲染函式
function filterStocksByMonth() { }    // 月份篩選
function filterStocksByMarket() { }   // 市場篩選
function updateStockStats() { }       // 更新統計
function renderStockPieChart() { }    // 圓餅圖
function renderStockTable() { }       // 表格
```

### 表格需求
- 顯示欄位: 市場、代號、名稱、股數、成本價、現價、市值、損益、報酬率
- 損益正數用綠色，負數用紅色
- 報酬率顯示百分比符號

### 驗收標準
- [ ] 月份和市場篩選器正常運作
- [ ] 統計數字計算正確
- [ ] 圓餅圖顯示各股票占比
- [ ] 表格資料完整且可篩選
- [ ] 損益顏色正確（正綠負紅）

### 提示給 AI Agent
在前面的基礎上，加入：
- 實作股票相關的所有函式
- 表格使用動態產生（innerHTML）
- 圓餅圖每個股票用不同顏色
- 統計計算：總市值、總損益、平均報酬率
- 市場篩選功能

---

## 🔧 Step 9: HTML 網頁 - 已實現損益頁面

### 任務目標
實作已實現損益分頁的完整功能

### 功能需求
1. **日期範圍選擇器**: 開始月份、結束月份
2. **統計卡片**: 總損益、交易次數、勝率
3. **長條圖**: 顯示月度損益（正數綠色、負數紅色）
4. **表格**: 列出所有交易紀錄（可依日期範圍篩選）

### HTML 結構（已在 Step 5 建立）
```html
<div id="pnl" class="tab-content">
    <!-- 日期篩選器 -->
    <input type="month" id="pnlStartMonth">
    <input type="month" id="pnlEndMonth">
    
    <!-- 統計卡片 -->
    <div id="pnlStats"></div>
    
    <!-- 長條圖 -->
    <canvas id="pnlChart"></canvas>
    
    <!-- 表格 -->
    <table id="pnlTable"></table>
</div>
```

### JavaScript 函式
```javascript
function renderPnL() { }              // 主渲染函式
function filterPnL() { }              // 日期範圍篩選
function updatePnLStats() { }         // 更新統計
function renderPnLChart() { }         // 長條圖
function renderPnLTable() { }         // 表格
```

### 統計計算
```javascript
// 總損益 = 所有已實現損益加總
// 交易次數 = 資料筆數
// 勝率 = (獲利次數 / 總次數) × 100%
```

### 長條圖需求
- X 軸: 月份
- Y 軸: 損益金額
- 正數用綠色柱狀，負數用紅色柱狀

### 驗收標準
- [ ] 日期範圍篩選正常
- [ ] 統計數字正確（總損益、交易次數、勝率）
- [ ] 長條圖顯示月度損益
- [ ] 表格按日期倒序排列
- [ ] 損益顏色正確

### 提示給 AI Agent
在前面的基礎上，加入：
- 實作已實現損益相關的所有函式
- 長條圖依損益正負顯示不同顏色
- 月度統計邏輯（將交易按月份分組）
- 勝率計算
- 表格按日期排序（最新在上）

---

## 🔧 Step 10: 測試與優化

### 任務目標
完整測試並優化使用者體驗

### 測試項目
1. **功能測試**
   - [ ] 上傳 CSV 功能正常
   - [ ] 三個分頁切換正常
   - [ ] 所有圖表顯示正確
   - [ ] 所有篩選器功能正常
   - [ ] 數值計算準確

2. **相容性測試**
   - [ ] Chrome 瀏覽器
   - [ ] Firefox 瀏覽器
   - [ ] Safari 瀏覽器（Mac）
   - [ ] Edge 瀏覽器

3. **響應式測試**
   - [ ] 桌面版（1920x1080）
   - [ ] 平板版（768x1024）
   - [ ] 手機版（375x667）

### 優化項目
1. **效能優化**
   - [ ] 加入載入動畫
   - [ ] 優化大量資料渲染
   - [ ] 圖表銷毀再建立（避免記憶體洩漏）

2. **使用者體驗**
   - [ ] 無資料時顯示提示訊息
   - [ ] 上傳成功顯示通知
   - [ ] 錯誤處理與提示
   - [ ] 加入使用說明

3. **視覺優化**
   - [ ] 圖表配色協調
   - [ ] 卡片陰影效果
   - [ ] 按鈕 hover 效果
   - [ ] 載入動畫流暢

### 驗收標準
- [ ] 無明顯 bug
- [ ] 載入速度 < 3 秒
- [ ] 各裝置顯示正常
- [ ] 使用者操作流暢

### 提示給 AI Agent
請進行以下優化：
- 加入載入動畫（CSS spinner）
- 無資料時顯示友善提示
- 圖表重繪前先檢查並銷毀舊圖表
- 加入錯誤處理（try-catch）
- 優化手機版的表格顯示（橫向滾動）

---

## 📝 使用說明

### 如何使用本文件

**情境 1: 開始開發**
```
使用者: 「我要開始 Step 1，請幫我建立銀行資產模組」
AI: 根據 Step 1 的規格建立程式碼
```

**情境 2: 完成驗收**
```
使用者: 「Step 1 已完成，請幫我檢查驗收標準」
AI: 根據驗收標準逐項檢查
使用者: 「通過驗收，請更新進度並提供 Step 2 的任務」
AI: 更新文件進度，提供 Step 2 規格
```

**情境 3: 遇到問題**
```
使用者: 「Step 5 的圖表顯示有問題」
AI: 根據 Step 5 的需求檢查問題
使用者: 「修正後繼續 Step 5」
AI: 提供修正方案
```

### 協作原則

1. **一次只處理一個 Step**
2. **完成驗收後才進入下一步**
3. **遇到問題先在當前 Step 解決**
4. **每個 Step 的程式碼可獨立運作**
5. **保持程式碼簡潔易懂**

---

## 🎯 快速指令範例

```
「開始 Step 1」
「Step X 完成，請驗收」
「更新進度到 Step X」
「Step X 遇到問題: [描述問題]」
「跳到 Step X」
「顯示目前進度」
「Step X 需要修改: [需求變更]」
```

---

## 📊 進度追蹤表

| Step | 任務 | 狀態 | 完成日期 | 備註 |
|------|------|------|----------|------|
| 1 | 銀行資產模組 | ⏳ 待開始 | - | - |
| 2 | 股票庫存模組 | ⏳ 待開始 | - | - |
| 3 | 已實現損益模組 | ⏳ 待開始 | - | - |
| 4 | 整合介面 | ⏳ 待開始 | - | - |
| 5 | HTML 基礎架構 | ⏳ 待開始 | - | - |
| 6 | CSV 上傳解析 | ⏳ 待開始 | - | - |
| 7 | 個人資產頁面 | ⏳ 待開始 | - | - |
| 8 | 股票庫存頁面 | ⏳ 待開始 | - | - |
| 9 | 已實現損益頁面 | ⏳ 待開始 | - | - |
| 10 | 測試與優化 | ⏳ 待開始 | - | - |

---

## 🔍 附錄：資料格式參考

### 銀行資產資料
```json
{
    "年月": "2025-01",
    "富邦": 100000,
    "將來": 50000,
    "國泰證券交割戶": 200000,
    "國泰(青年子帳戶)": 500000,
    "LINEPAY": 5000,
    "股票/ETF(國泰)": 300000,
    "保單金": 0,
    "資產總計": 1155000
}
```

### 股票庫存資料
```json
{
    "年月": "2025-01",
    "市場": "台股",
    "股票代號": "2330",
    "股票名稱": "台積電",
    "持有股數": 10,
    "總成本": 5000,
    "總市值": 5800,
    "未實現損益": 800,
    "報酬率%": 16.00
}
```

### 已實現損益資料
```json
{
    "日期": "2025-01-15",
    "市場": "台股",
    "股票代號": "2454",
    "股票名稱": "聯發科",
    "賣出股數": 5,
    "總成本": 4000,
    "賣出價": 4500,
    "已實現損益": 500,
    "報酬率%": 12.50
}
```

---

## 📌 重要提醒

1. **Python 版本**: 使用 Python 3（無需安裝 pandas 或其他額外套件）
2. **CSV 編碼**: 務必使用 UTF-8-sig 避免中文亂碼
3. **數值格式**: 金額不要包含逗號，報酬率保留兩位小數
4. **日期格式**: 年月用 `YYYY-MM`，完整日期用 `YYYY-MM-DD`
5. **計算邏輯**:
   - 股票未實現損益 = **總市值 - 總成本**
   - 已實現損益 = **賣出價 - 總成本**
6. **銀行欄位**: 支援動態銀行名稱（可包含括號，如：國泰(青年子帳戶)）
7. **已移除欄位**: 已實現損益 CSV 不包含「交易類型」欄位
8. **圖表銷毀**: 重繪前務必先 `chart.destroy()` 避免記憶體洩漏
9. **測試資料**: 每個 Step 都包含範例資料，可直接測試

---

## ✅ 驗收通過標準

每個 Step 完成後，必須滿足：
1. 程式可執行無錯誤
2. 符合所有驗收標準
3. 程式碼有適當註解
4. 測試資料運作正常

---

**準備好了嗎？請告訴我要開始哪個 Step！** 🚀